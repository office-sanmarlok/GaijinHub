# 言語に基づく検索機能の実装手順

## 実装タスク

### 1. 現状分析
- [x] SearchFormコンポーネントの現在の実装を確認
- [x] 検索APIエンドポイントの現在の実装を確認
- [x] データベースのlisting_translationsテーブルの構造を確認
- [x] 言語フィルタリングに必要なパラメータを特定

**確認した内容：**
- listing_translationsテーブルには`locale`フィールドがある（ja, en, ko, zh-CN, zh-TW）
- 各翻訳には`title`と`body`が保存されている
- 現在の検索はlistingsテーブルのみで、翻訳を考慮していない

### 2. フロントエンド実装
- [x] SearchFormに言語選択フィールドを追加
- [x] 言語パラメータをAPIリクエストに含める
- [ ] UIデザインの実装（言語選択ドロップダウン）

### 3. バックエンド実装
- [x] 検索APIエンドポイントに言語フィルタリング機能を追加
- [x] SQLクエリまたはSupabase関数を更新して言語でフィルタリング
- [ ] 言語パラメータのバリデーションを追加

### 4. テスト
- [x] 言語フィルタリングが正しく動作することを確認
- [x] 複数言語での検索結果を確認
- [x] エッジケース（言語未選択、無効な言語コード等）のテスト

### 5. 最適化とリファクタリング
- [x] パフォーマンスの確認
- [x] コードのクリーンアップ
- [ ] 必要に応じてインデックスの追加

## 実装完了

言語に基づく検索機能の実装が完了しました。

### 実装内容：
1. **SearchFormコンポーネント**に言語選択ドロップダウンを追加
2. **検索APIエンドポイント**に言語パラメータのサポートを追加
3. **データベース関数**（search_listings）に言語フィルタリング機能を追加（original_languageベース）
4. **翻訳ファイル**（en.json, ja.json, ko.json, zh-CN.json, zh-TW.json）に必要なメッセージを追加
5. **検索結果ページ**で言語フィルタの表示とURLパラメータの処理を実装

### 機能の特徴：
- 「すべての言語」を選択すると、全言語のリスティングを表示
- 特定の言語を選択すると、その言語で作成されたリスティングのみを表示（original_languageフィールドに基づく）
- 言語フィルタはURLパラメータとして保存され、ページリロード時も保持される
- 検索結果に言語フィルタが適用されていることが視覚的に表示される